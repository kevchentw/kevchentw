<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="前端開發踩到的坑 HTTP/2.0 與 HTTP/1.1 的差異">
    <meta name="description" content="紀錄一次 dev 與 prod 環境差異所踩到的坑，並教你如何啟用 HTTP/2.0 的開發環境">
  <meta property="og:description" content="紀錄一次 dev 與 prod 環境差異所踩到的坑，並教你如何啟用 HTTP/2.0 的開發環境">
    <meta property="og:type" content="blog">
  <title>前端開發踩到的坑 HTTP/2.0 與 HTTP/1.1 的差異</title>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index.html">
      <div class="Navbar__Btn"><span>📖</span> <span>Home</span></div>
    </a>
                                                                    <span class="Navbar__Delim">&centerdot;</span>
    <a href="about.html">
      <div class="Navbar__Btn"><span>😀</span> <span>About Me</span></div>
    </a>
                <span class="Navbar__Delim">&centerdot;</span>
    <a href="ibrary.html">
      <div class="Navbar__Btn"><span>📕</span> <span>Library</span></div>
    </a>
                  </nav>
  <header class="Header">
        <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
        <h1 class="Header__Title">前端開發踩到的坑 HTTP/2.0 與 HTTP/1.1 的差異</h1>
        <div class="DateTagBar">
            <span class="DateTagBar__Item DateTagBar__Date">Posted on Wed, May 6, 2020</span>
                  <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--pink">
        <a href="tag/web.html">web</a>
      </span>
            <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--yellow">
        <a href="tag/js.html">js</a>
      </span>
          </div>
      </header>
  <article id="https://www.notion.so/31ab300a7dbb40549539075e72b0e4b8" class="PageRoot"><blockquote id="https://www.notion.so/72d3307c16e942579ea39b6b7316656b" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">要記得 Development 的環境與 Production 永遠無法相同</span></span></blockquote><h1 id="https://www.notion.so/d9c489530b384cbea124b3e2d8249ed9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/d9c489530b384cbea124b3e2d8249ed9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">前言</span></span></h1><h3 id="https://www.notion.so/168f1f1eb6264a7db43849b951da683f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/168f1f1eb6264a7db43849b951da683f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">發生了什麼</span></span></h3><div id="https://www.notion.so/11cf53bb056a4e2ba029805bbdab72ac" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">有一天使用者跟我們回報他在網頁上操作批次動作時 (打 10~1000 個 API Requests)，竟然把 API 打到掛掉。</span></span></p></div><h3 id="https://www.notion.so/7d5245c910984623ac228f4fc6054550" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/7d5245c910984623ac228f4fc6054550"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">原本預期的行為 </span></span></h3><div id="https://www.notion.so/541a56bf0cbb46eb95ad2512b14a92ba" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以下是我們 Batch Fetch 的範例 Code</span></span></p></div><pre id="https://www.notion.so/13973baa5def452983714ac6a78bfc1b" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">url</span> <span class="token operator">=></span>
  <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token operator">...</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/134bd375461e400fbf28e5c9a1d57a2d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">這段程式在本機測試時打 1000 個請求時，瀏覽器會慢慢的送請求 (大約同時 5 個)，當時沒有想太多，認為瀏覽器會幫忙做請求限制，因此沒有另外做處裡。</span></span></p></div><h1 id="https://www.notion.so/dee6937bb7254d528fa0d247aece03ee" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/dee6937bb7254d528fa0d247aece03ee"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">尋找問題</span></span></h1><div id="https://www.notion.so/8b19d5d396bf44b7b4b68bacccf26f10" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">一開始我先到 Staging 環境測試做相同的測試，過沒幾秒就把後端打壞了。然後回到自己機器上的開發環境卻是慢慢的打。</span></span></p></div><div id="https://www.notion.so/32d9091a061141af8d7512aae2d77b5d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">此時就去問 Google 大神，尋找 Parallel+Connection+Chrome 有關的資訊，發現這篇 Stack Overflow</span></span></p></div><div id="https://www.notion.so/bac2576a8ff44dd489173d41798c2626" class="Bookmark"><a href="https://stackoverflow.com/questions/985431/max-parallel-http-connections-in-a-browser"><h5 class="Bookmark__Title">Max parallel http connections in a browser?</h5><p class="Bookmark__Desc">I am creating some suspended connections to an HTTP server (comet, reverse ajax, etc). It works ok, but I see the browser only allows two suspended connections to a given domain simultaneously. So if a user is looking at my website in Tab1 of their browser, then also tries loading it in Tab2, they&#x27;ve used up the two allowed connections to my site.</p><p class="Bookmark__Link">https://stackoverflow.com/questions/985431/max-parallel-http-connections-in-a-browser</p></a></div><div id="https://www.notion.so/06c626aad50b4255bdce922597a5eb34" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Chrome 確實會限制同時 6 個 Connection ，但是只有在 HTTP/1.1 的情況下。然而</span></span></p></div><div id="https://www.notion.so/230bdd3522754c11b37ada2f487dce1d" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">⚠️</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">HTTP/2: Multiplexed support (one single TCP connection for all requests)</span></span></p></div><div id="https://www.notion.so/495a00fb1e884ef1b6132a8faffcfd84" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">再回到剛剛 Staging 跟自己機器上，原來我們 Staging/Production 都是使用 HTTP2，而開發環境則是 HTTP/1.1。謎團終於解開了！</span></span></p></div><h3 id="https://www.notion.so/cc855c0793a94fffb8c1caaee39b1f93" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/cc855c0793a94fffb8c1caaee39b1f93"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">是什麼造成這樣的差異</span></span></h3><div id="https://www.notion.so/3906585fb59745348cb06b3b80cc6814" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我們前端開發環境使用 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/facebook/create-react-app">Create React App</a></span><span class="SemanticString"> 搭配 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/chimurai/http-proxy-middleware">http-proxy-middleware</a></span><span class="SemanticString">，這裡的跑起來的 Server 只支援 HTTP/1.1</span></span></p></div><pre id="https://www.notion.so/a7f12c778e9642fabc6a0173bd798171" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token string">'http://localhost:8080'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></span></span></span></code></pre><div id="https://www.notion.so/e7bbf9d2c6fa44caa6c0898ed9d4718a" class="Bookmark"><a href="https://create-react-app.dev/docs/proxying-api-requests-in-development/"><h5 class="Bookmark__Title">Create React App · Set up a modern web app by running one command.</h5><p class="Bookmark__Desc">Note: this feature is available with [email protected] and higher. People often serve the front-end React app from the same host and port as their backend implementation.</p><p class="Bookmark__Link">https://create-react-app.dev/docs/proxying-api-requests-in-development/</p></a></div><div id="https://www.notion.so/ead6688e81ae41489c9a88d07f1d41c3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/283cc79a5bf44fa1a345b5b215ccc8d5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">而我們部屬在 AWS 上則是使用 Application Load Balancer 來轉發 API/Frontend 的請求，預設開啟 HTTP/2。</span></span></p></div><h1 id="https://www.notion.so/b5b9ab9606f143bb8dedee60b17a6cbb" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/b5b9ab9606f143bb8dedee60b17a6cbb"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">如何解決</span></span></h1><h3 id="https://www.notion.so/7c6396ad2bb041faa387ad630853e71a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/7c6396ad2bb041faa387ad630853e71a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">控制 Promise 的併發數</span></span></h3><div id="https://www.notion.so/f8d7b868a2fe4b97bd0aa6f449e07288" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">使用 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/sindresorhus/p-limit">p-limit</a></span><span class="SemanticString"> 這個套件來控制併發數，問題解決！</span></span></p></div><h3 id="https://www.notion.so/bd14afab884e4f93bb5c7623f90c0037" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/bd14afab884e4f93bb5c7623f90c0037"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">在開發環境測試 HTTP/2.0 環境</span></span></h3><div id="https://www.notion.so/25b8c214b5914f999a6838a41b783e90" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">首先嘗試讓 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">http-proxy-middleware</code></span><span class="SemanticString"> 支援 HTTP/2.0，有發現相關 Issue 但沒有解決方法。</span></span></p></div><div id="https://www.notion.so/90869b749bf34ac4a4e36ea179ba8408" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">最終決定在本機使用 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://caddyserver.com/">Caddy</a></span><span class="SemanticString"> 這套當作 Reverse Proxy + Static File Server</span></span></p></div><div id="https://www.notion.so/6b7a2983c3774a878bac9e3de6d86280" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">選擇 Caddy 這套的理由如下</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/cdbd9a7d8f084964920709d60cb84ec1" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">支援 HTTP/2.0</span></span></li><li id="https://www.notion.so/deda3419d88840ef9824eb45cb35f84b" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">自動 HTTPS</span></span></li><li id="https://www.notion.so/e4cf34e1e8f94adcbf3a6c054e35d213" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">可作為 File Server</span></span></li><li id="https://www.notion.so/1a5fbbc5264d4b6d83776e90bfde84cf" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">使用+設定簡單</span></span></li></ol><div id="https://www.notion.so/47dc2472cb0b4475b628927ffd80cad5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">原本也有考慮使用 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.nginx.com/">Nginx</a></span><span class="SemanticString"> 或 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://docs.traefik.io/">Traefik</a></span><span class="SemanticString">，但 nginx 用起來比較複雜而 traefik 沒有內建 file server</span></span></p></div><div id="https://www.notion.so/f1cbd9ffbca8442b915e9527f9a1a569" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/1dc6ef5a6ff94563906cb83bac088c63" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Caddyfile</code></span></span></p></div><pre id="https://www.notion.so/129fe64b9633411ab427167d5bf0ea78" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>localhost

root ./build
file_server
reverse_proxy /api/* 127.0.0.1:8080</span></span></span></code></pre><h3 id="https://www.notion.so/0df8c761223d4d1cae9296a3be74d247" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/0df8c761223d4d1cae9296a3be74d247"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">使用方法</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/2d65464e536d43e28b5e7940645cdb03" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">安裝 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://caddyserver.com/docs/install">https://caddyserver.com/docs/install</a></span><span class="SemanticString"> </span></span></li><li id="https://www.notion.so/4eb0f1cd4f754be1989a47abc5fcbb61" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">將上面的設定檔取名 Caddyfile 放在前端專案的目錄</span></span></li><li id="https://www.notion.so/e77b4ed9196a4f45ae1426e220d97611" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">yarn build</code></span><span class="SemanticString"> 打包前端</span></span></li><li id="https://www.notion.so/b46573241c20475cbe3e7bc48b4f163b" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">sudo caddy run</code></span><span class="SemanticString"> (需要存取 443 port 因此要 sudo 權限)</span></span></li><li id="https://www.notion.so/b461fbd7be0d48a483e43ae9ff6a29d2" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">此時連上 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://localhost">https://localhost </a></span><span class="SemanticString">即可看到 HTTP2.0 的網頁！</span></span></li></ol><h1 id="https://www.notion.so/b88e351679d3422a83582b82f6ecc338" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/b88e351679d3422a83582b82f6ecc338"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">後記</span></span></h1><div id="https://www.notion.so/3a790e11672a4155b31912683a989d83" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">最後還是要回到這次問題的根源 「API 為什麼會被打掛?」，在當下看 ALB 及 API Log 並沒有看出問題所在。在寫這篇文章的同時再次測試，發現以下的錯誤訊息，要怎樣解決就留到之後的文章吧！ </span></span></p></div><pre id="https://www.notion.so/9d6f678e31bf409a92c8b5f31942fcf6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>sqlalchemy<span class="token punctuation">.</span>exc<span class="token punctuation">.</span>TimeoutError<span class="token punctuation">:</span> QueuePool limit of size <span class="token number">5</span> overflow <span class="token number">10</span> reached<span class="token punctuation">,</span> connection timed out<span class="token punctuation">,</span> timeout <span class="token number">30</span> <span class="token punctuation">(</span>Background on this error at<span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">//</span>sqlalche<span class="token punctuation">.</span>me<span class="token operator">/</span>e<span class="token operator">/</span>3o7r<span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/9512e503020842b1ae91a0d0dd934373" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/8b8dc44506e54008ba7fcceb796d474c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>  <div class="PageRoot">
    <div class="commentbox"></div>
  </div>
  
  <footer class="Footer">
    <div>&copy; Kuan Yin Chen's Blog 2020</div>
    <div>&centerdot;</div>
    <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
        rel="noopener noreferrer">Notablog</a>.
    </div>
    <div>&centerdot;</div>
    <div>Hosted on <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">Github Page</a>.
    </div>
    <div>&centerdot;</div>
    <div>Built with <a href="https://travis-ci.com/" target="_blank" rel="noopener noreferrer">Travis CI
      </a>.
    </div>
  </footer>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149417493-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-149417493-2');
  </script>
  <script src="https://unpkg.com/commentbox.io/dist/commentBox.min.js"></script>
  <script>
    commentBox('5758508054085632-proj');
  </script>
</body>

</html>